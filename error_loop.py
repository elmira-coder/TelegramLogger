# error_loop.py
"""
Модуль с генератором случайных ошибок для демонстрации работы логгера.

Файл:
- Запускает бесконечный цикл.
- Периодически генерирует случайные ошибки.
- Логирует ошибки в файл и через Telegram.
- Используется в основном приложении (main.py) в отдельном потоке.
"""

import time
import random
from error_generator import generate_error


def error_loop(logger):
    """
    Функция генерации ошибок.

    Аргументы:
    logger -- объект логгера для записи сообщений и ошибок

    Действия:
    1. Записывает в лог, что генератор запущен.
    2. Запускает бесконечный цикл:
        - ждёт случайное время (5-20 секунд),
        - случайно решает, генерировать ошибку или просто логировать итерацию,
        - при возникновении ошибки логирует её со стек-трейсом.
    """
    logger.info("Генератор ошибок запущен")

    while True:
        try:
            # Пауза между итерациями (рандомно от 5 до 20 секунд)
            time.sleep(random.randint(5, 20))

            # Случайно решаем: генерируем ошибку или логируем "чистую" итерацию
            if random.random() < 0.6:
                generate_error()  # Генерация случайной ошибки
            else:
                logger.info("Итерация без ошибок")  # Просто логируем обычное сообщение

        except Exception:
            # Если произошла ошибка, записываем её полностью (со стек-трейсом)
            logger.exception("Автоматически сгенерированная ошибка")
