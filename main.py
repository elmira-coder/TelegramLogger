# main.py
"""
Главный файл проекта "Telegram Logger".

Назначение:
- Запуск всей системы логирования в одном месте.
- Поднимает Telegram-бота, который принимает команды от пользователей.
- Параллельно запускает генератор случайных ошибок, чтобы демонстрировать работу логгера.
- Все ошибки пишутся в файл и отправляются подписанным пользователям в Telegram.

Архитектура:
- Генератор ошибок работает в отдельном потоке (daemon thread).
- Telegram-бот работает в основном потоке и обрабатывает команды пользователей.
"""

# Импорт модуля для работы с потоками
import threading

# Импорт функции для настройки логгера
from logger_setup import setup_logger

# Импорт функции генератора случайных ошибок
from error_loop import error_loop

# Импорт функции запуска Telegram-бота
from bot_runner import run_bot


def main():
    """
    Основная функция приложения.

    Действия:
    1. Настраивает логгер и записывает, что приложение запущено.
    2. Запускает генератор ошибок в отдельном потоке, чтобы ошибки генерировались
       параллельно с ботом.
    3. Запускает Telegram-бота в основном потоке.
    """

    # Настройка логгера (пишет в файл и в Telegram)
    logger = setup_logger()
    logger.info("Приложение запущено")

    # ------------------------------------------------------------
    # 1. Запуск генератора ошибок в отдельном потоке
    # ------------------------------------------------------------
    # threading.Thread создаёт новый поток выполнения.
    # target=error_loop → функция, которая будет выполняться в этом потоке.
    # args=(logger,) → передаём объект логгера в функцию генератора ошибок.
    # daemon=True → поток завершится автоматически при закрытии основного процесса.
    error_thread = threading.Thread(
        target=error_loop,
        args=(logger,),
        daemon=True
    )
    # Старт потока
    error_thread.start()

    # ------------------------------------------------------------
    # 2. Запуск Telegram-бота (в основном потоке)
    # ------------------------------------------------------------
    # run_bot() поднимает бота и запускает polling для получения сообщений от пользователей.
    # Этот вызов блокирующий, то есть программа дальше не идёт, пока бот работает.
    run_bot()


# ------------------------------------------------------------
# Точка входа в приложение
# ------------------------------------------------------------
# Если файл main.py запускается напрямую, вызывается main().
# Это стандартная конструкция в Python.
if __name__ == "__main__":
    main()
